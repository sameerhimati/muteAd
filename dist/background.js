chrome.runtime.onInstalled.addListener((function(){console.log("Ad Muter extension installed"),chrome.storage.sync.set({adMuterEnabled:!0,adsMuted:0,secondsSaved:0},(function(){console.log("Initial settings saved")}))})),chrome.runtime.onMessage.addListener((function(e,t,s){if("muteTab"===e.action)chrome.tabs.update(t.tab.id,{muted:!0}),s({success:!0});else if("unmuteTab"===e.action)chrome.tabs.update(t.tab.id,{muted:!1}),a=e.adDuration,chrome.storage.sync.get(["adsMuted","secondsSaved"],(function(e){var t=e.adsMuted||0,s=e.secondsSaved||0;t++,s+=a||0,chrome.storage.sync.set({adsMuted:t,secondsSaved:s},(function(){console.log("Metrics updated:",{adsMuted:t,secondsSaved:s})}))})),s({success:!0});else{if("getMetrics"===e.action)return chrome.storage.sync.get(["adsMuted","secondsSaved"],(function(e){var t,a,n,o,d;s({adsMuted:e.adsMuted||0,timeSaved:(t=e.secondsSaved||0,a=Math.floor(t/3600),n=Math.floor(t%3600/60),o=t%60,d="",a>0&&(d+="".concat(a,"h ")),(n>0||a>0)&&(d+="".concat(n,"m ")),(d+="".concat(o,"s")).trim())})})),!0;if("updateMetrics"===message.action)return chrome.storage.sync.get(["timeMuted","adsMuted"],(function(e){var t=(e.timeMuted||0)+(message.adDuration||0),a=(e.adsMuted||0)+1;chrome.storage.sync.set({timeMuted:t,adsMuted:a},(function(){console.log("Metrics updated:",{timeMuted:t,adsMuted:a}),s({success:!0})}))})),!0;if("ping"===e.action)s({success:!0});else{if("setAdMuterState"===message.action)return chrome.storage.sync.set({adMuterEnabled:message.enabled},(function(){chrome.tabs.query({},(function(e){e.forEach((function(e){chrome.tabs.sendMessage(e.id,{action:"updateAdMuterState",enabled:message.enabled}).catch((function(){})),message.enabled||chrome.tabs.update(e.id,{muted:!1},(function(){chrome.runtime.lastError&&console.error("Error unmuting tab:",chrome.runtime.lastError)}))}))})),s({success:!0})})),!0;if("getAdMuterState"===e.action)return chrome.storage.sync.get("adMuterEnabled",(function(e){s({enabled:e.adMuterEnabled})})),!0}}var a;return!0})),console.log("Background script loaded");