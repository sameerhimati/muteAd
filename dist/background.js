chrome.runtime.onInstalled.addListener((function(){console.log("Ad Muter extension installed"),chrome.storage.sync.set({adMuterEnabled:!0,adsMuted:0,secondsSaved:0},(function(){console.log("Initial settings saved")}))})),chrome.runtime.onMessage.addListener((function(e,t,s){if("muteTab"===e.action)chrome.tabs.update(t.tab.id,{muted:!0}),s({success:!0});else if("unmuteTab"===e.action)chrome.tabs.update(t.tab.id,{muted:!1}),a=e.adDuration,chrome.storage.sync.get(["adsMuted","secondsSaved"],(function(e){var t=e.adsMuted||0,s=e.secondsSaved||0;t++,s+=a||0,chrome.storage.sync.set({adsMuted:t,secondsSaved:s},(function(){console.log("Metrics updated:",{adsMuted:t,secondsSaved:s})}))})),s({success:!0});else{if("getMetrics"===e.action)return chrome.storage.sync.get(["adsMuted","secondsSaved"],(function(e){var t,a,n,d,c;s({adsMuted:e.adsMuted||0,timeSaved:(t=e.secondsSaved||0,a=Math.floor(t/3600),n=Math.floor(t%3600/60),d=t%60,c="",a>0&&(c+="".concat(a,"h ")),(n>0||a>0)&&(c+="".concat(n,"m ")),(c+="".concat(d,"s")).trim())})})),!0;if("updateMetrics"===e.action)return chrome.storage.sync.get(["timeMuted","adsMuted"],(function(t){var a=(t.timeMuted||0)+(e.adDuration||0),n=(t.adsMuted||0)+1;chrome.storage.sync.set({timeMuted:a,adsMuted:n},(function(){console.log("Metrics updated:",{timeMuted:a,adsMuted:n}),s({success:!0})}))})),!0;if("setAdMuterState"===e.action)return chrome.storage.sync.set({adMuterEnabled:e.enabled},(function(){chrome.tabs.query({},(function(t){t.forEach((function(t){chrome.tabs.sendMessage(t.id,{action:"updateAdMuterState",enabled:e.enabled}).catch((function(){}))}))})),s({success:!0})})),!0;if("ping"===e.action)s({success:!0});else if("getAdMuterState"===e.action)return chrome.storage.sync.get("adMuterEnabled",(function(e){s({enabled:e.adMuterEnabled})})),!0}var a;return!0})),console.log("Background script loaded");