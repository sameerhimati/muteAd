(()=>{var e=null,n=!1,o=!1,t=0,r=0,a=0,i=0,c=0;function s(){e&&e.disconnect(),e=new MutationObserver((function(){u()}));var n={childList:!0,subtree:!0,attributes:!0,characterData:!0};!function o(){var t=document.querySelector("#content-video-player")||document.body;t?(console.log("Player container found, initializing ad detection"),e.observe(t,n),setInterval(u,1e3)):(console.log("Player container not found, will retry"),setTimeout(o,1e3))}(),console.log("Hulu ad detection initialized")}function u(){if(n)try{var e=[".ad-container",".AdUnitView",".ad-overlay",".ad-progress-bar",'[data-automation-id="ad-unit"]','[data-automationid="player-ad-notice"]',".AdBanner",".AdTag","[data-ad-break-type]","[data-ad-break-start]"].some((function(e){return document.querySelector(e)}))||function(){var e=document.querySelector("video");if(!e)return!1;var n=e.currentTime,o=e.duration,t=Math.abs(o-a)>5,i=Math.abs(n-r)>5&&Math.abs(n-r)<o-5;return r=n,a=o,t||i}()||!1;e?++i>=3&&!o&&(o=!0,t=Date.now(),console.log("Hulu ad detected, attempting to mute tab"),chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"muteTab"},(function(e){chrome.runtime.lastError?(console.error("Error sending mute message:",chrome.runtime.lastError),d(chrome.runtime.lastError)):e&&e.success?console.log("Tab muted successfully"):console.error("Failed to mute tab:",e?e.error:"Unknown error")})):(console.error("Chrome runtime not available"),d(new Error("Chrome runtime not available")))):(i>=3&&o&&(o=!1,l()),i=0),console.log("Hulu ad check:",{adDetected:e,consecutiveAdChecks:i,isAdPlaying:o}),c=0}catch(e){console.error("Error checking for Hulu ads:",e),d(e)}}function l(){console.log("Ad ended, attempting to unmute tab");var e=Math.round((Date.now()-t)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully")})).catch((function(e){console.error("Error sending unmute message:",e),d(e)}))}function d(e){console.error("Handling extension error:",e),(e.message.includes("Extension context invalidated")||e.message.includes("Chrome runtime not available"))&&m()}function m(){c>=5?console.error("Max reconnection attempts reached. Please refresh the page."):(c++,console.log("Attempting to reconnect to extension (Attempt ".concat(c,")")),setTimeout((function(){chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"ping"},(function(e){chrome.runtime.lastError?(console.log("Reconnection failed, retrying..."),m()):(console.log("Reconnected to extension successfully"),s())})):(console.log("Chrome runtime still not available, retrying..."),m())}),2e3))}function g(){chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"getAdMuterState"},(function(e){chrome.runtime.lastError?(console.error("Failed to get initial state:",chrome.runtime.lastError),m()):(n=e.enabled)&&s()})):(console.error("Chrome runtime not available on initialization"),m())}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((function(t,r,a){return"updateAdMuterState"===t.action&&((n=t.enabled)?s():(e&&(e.disconnect(),e=null),console.log("Ad detection stopped"),o&&l()),a({success:!0})),!0})),console.log("Hulu content script loaded")})();