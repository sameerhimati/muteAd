(()=>{var e=null,n=!1,t=!1,o=0,r=0,a=0,c=0,i=0;function s(){e&&e.disconnect(),e=new MutationObserver((function(){u()}));var n={childList:!0,subtree:!0,attributes:!0,characterData:!0};!function t(){var o=document.querySelector("#content-video-player")||document.body;o?(console.log("Player container found, initializing ad detection"),e.observe(o,n),setInterval(u,1e3)):(console.log("Player container not found, will retry"),setTimeout(t,1e3))}(),console.log("Hulu ad detection initialized")}function u(){if(n)try{var e=[".ad-container",".AdUnitView",".ad-overlay",".ad-progress-bar",'[data-automation-id="ad-unit"]','[data-automationid="player-ad-notice"]',".AdBanner",".AdTag","[data-ad-break-type]","[data-ad-break-start]"].some((function(e){return document.querySelector(e)}))||function(){var e=document.querySelector("video");if(!e)return!1;var n=e.currentTime,t=e.duration,o=Math.abs(t-a)>5,c=Math.abs(n-r)>5&&Math.abs(n-r)<t-5;return r=n,a=t,o||c}()||!1;e?++c>=3&&!t&&(t=!0,o=Date.now(),console.log("Ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){if(!e||!e.success)throw new Error("Failed to mute tab: "+(e?e.error:"Unknown error"));console.log("Tab muted successfully")})).catch((function(e){console.error("Error sending mute message:",e),l(e)}))):(c>=3&&t&&(t=!1,d()),c=0),console.log("Hulu ad check:",{adDetected:e,consecutiveAdChecks:c,isAdPlaying:t}),i=0}catch(e){console.error("Error checking for Hulu ads:",e),l(e)}}function d(){console.log("Ad ended, attempting to unmute tab");var e=Math.round((Date.now()-o)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully")})).catch((function(e){console.error("Error sending unmute message:",e),l(e)}))}function l(e){console.error("Handling extension error:",e),(e.message.includes("Extension context invalidated")||e.message.includes("Chrome runtime not available"))&&m()}function m(){i>=5?console.error("Max reconnection attempts reached. Please refresh the page."):(i++,console.log("Attempting to reconnect to extension (Attempt ".concat(i,")")),setTimeout((function(){chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"ping"}).then((function(e){console.log("Reconnected to extension successfully"),s()})).catch((function(e){console.log("Reconnection failed, retrying..."),m()})):(console.log("Chrome runtime still not available, retrying..."),m())}),2e3))}function g(){chrome.runtime?chrome.runtime.sendMessage({action:"getAdMuterState"}).then((function(e){if(!e)throw new Error("No response received from background script");(n=e.enabled)&&s()})).catch((function(e){console.error("Failed to get initial state:",e.message),m()})):console.error("Chrome runtime not available")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((function(o,r,a){return"updateAdMuterState"===o.action&&((n=o.enabled)?s():(e&&(e.disconnect(),e=null),console.log("Ad detection stopped"),t&&d()),a({success:!0})),!0})),console.log("Hulu content script loaded")})();