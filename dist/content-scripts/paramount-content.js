(()=>{var e=null,n=!0,o=!1,t=0,a=0;function r(){if(n)try{var e=[".ad-container",".ad-overlay",".ad-banner",'[data-testid="ad-overlay"]','[data-testid="ad-banner"]',".video-player__overlay--ad-playing"].some((function(e){return document.querySelector(e)}))||((r=document.querySelector("video"))&&(r.currentTime,r.duration),!1)||!1;e?++a>=3&&!o&&(o=!0,t=Date.now(),console.log("Paramount+ ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){e&&e.success?console.log("Tab muted successfully"):console.log("Failed to mute tab:",e?e.error:"Unknown error")})).catch((function(e){console.log("Error sending mute message:",e),c(e)}))):(a>=3&&o&&(o=!1,console.log("Paramount+ ad ended, attempting to unmute tab"),chrome.runtime.sendMessage({action:"unmuteTab"}).then((function(e){var n;e&&e.success?(console.log("Tab unmuted successfully"),n=Math.round((Date.now()-t)/1e3),chrome.runtime.sendMessage({action:"updateMetrics",muteDuration:n})):console.log("Failed to unmute tab:",e?e.error:"Unknown error")})).catch((function(e){console.log("Error sending unmute message:",e),c(e)}))),a=0),console.log("Paramount+ ad check:",{adDetected:e,consecutiveAdChecks:a,isAdPlaying:o})}catch(e){console.log("Error checking for Paramount+ ads:",e),c(e)}var r}function c(e){console.log("Handling extension error:",e),e.message.includes("Extension context invalidated")?(console.log("Extension context invalidated. Reloading ad detection."),d(),setTimeout((function(){s()}),1e3)):e.message.includes("Permission denied")&&console.log("Permission denied error. This may affect some functionality.")}function s(){e&&e.disconnect(),e=new MutationObserver((function(){r()}));var n={childList:!0,subtree:!0,attributes:!0,characterData:!0};function o(){var o=document.querySelector("#video-player")||document.body;e.observe(o,n),console.log("Observing Paramount+ player container"),r(),console.log("Paramount+ ad detection initialized")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o(),setInterval(r,1e3)}function d(){e&&(e.disconnect(),e=null),console.log("Ad detection stopped")}chrome.storage.sync.get(["adMuterEnabled"],(function(e){(n=void 0===e.adMuterEnabled||e.adMuterEnabled)&&s()})),chrome.runtime.onMessage.addListener((function(e,o,t){return"toggleAdMuter"===e.action&&(n=e.enabled,console.log("Ad Muter toggled on Paramount+:",n),n?s():d(),t({success:!0})),!0})),s(),console.log("Paramount+ content script loaded")})();