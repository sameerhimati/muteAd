(()=>{var e=null,n=!1,t=!1,o=!1,r=0,a=0,i=0;function c(){if(n)try{var e=function(){var e=document.querySelector('iframe[src*="imasdk.googleapis.com"]');if(e){var n=window.getComputedStyle(e);return"none"!==n.display&&"hidden"!==n.visibility}return!1}(),c=function(){var e=document.querySelector('[data-role="adClickEl"]');if(e){var n=window.getComputedStyle(e);return"none"!==n.display&&"hidden"!==n.visibility}return!1}(),l=!!(f=document.querySelector('[data-role="adContainer"]'))&&"none"!==window.getComputedStyle(f).display&&""!==f.innerHTML.trim(),u=function(){var e=document.querySelector(".ad-info-manager-circular-loader-copy");if(e&&null!==e.offsetParent){var n=parseInt(e.textContent);if(!isNaN(n)&&n>0)return console.log("Ad countdown found:",n),!0}return!1}(),m=[".ad-container",".ad-overlay",".ad-banner",'[data-testid="ad-overlay"]','[data-testid="ad-banner"]',".video-player__overlay--ad-playing",".ad-persistent-player",".ad-ui-view",'[data-purpose="ad-banner"]','[data-purpose="ad-container"]',".ad-player-overlay",".ad-playback-progress",".video-ad-overlay"].some((function(e){var n=document.querySelector(e);if(n){var t=window.getComputedStyle(n);return"none"!==t.display&&"hidden"!==t.visibility&&""!==n.innerHTML.trim()}return!1})),g=e||c||l||u&&m;console.log("Ad detection results:",{adIframeActive:e,adClickElementVisible:c,adContainerActive:l,adCountdown:u,visualMarkers:m}),g?(a++,console.log("Ad detected, consecutive checks: ".concat(a)),a>=2&&!o&&(o=!0,r=Date.now(),console.log("Paramount+ ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){if(!e||!e.success)throw new Error("Failed to mute tab: "+(e?e.error:"Unknown error"));console.log("Tab muted successfully"),t=!0})).catch((function(e){console.error("Error sending mute message:",e),s(e)})))):(o&&d(),a=0,o=!1),console.log("Paramount+ ad check:",{adDetected:g,consecutiveAdChecks:a,isAdPlaying:o}),i=0}catch(e){console.error("Error checking for Paramount+ ads:",e),s(e)}var f}function d(){if(t){console.log("Paramount+ ad ended, attempting to unmute tab");var e=Math.round((Date.now()-r)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully"),t=!1})).catch((function(e){console.error("Error sending unmute message:",e),s(e)}))}}function s(e){console.error("Handling extension error:",e),(e.message.includes("Extension context invalidated")||e.message.includes("Chrome runtime not available"))&&l()}function l(){i>=5?console.error("Max reconnection attempts reached. Please refresh the page."):(i++,console.log("Attempting to reconnect to extension (Attempt ".concat(i,")")),setTimeout((function(){chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"ping"}).then((function(e){console.log("Reconnected to extension successfully"),u()})).catch((function(e){console.log("Reconnection failed, retrying..."),l()})):(console.log("Chrome runtime still not available, retrying..."),l())}),2e3))}function u(){e&&e.disconnect(),e=new MutationObserver((function(){c()}));var n={childList:!0,subtree:!0,attributes:!0,characterData:!0};!function t(){var o=document.querySelector("#video-player")||document.body;o?(console.log("Player container found, initializing ad detection"),e.observe(o,n),setInterval(c,250)):(console.log("Player container not found, will retry"),setTimeout(t,1e3))}(),console.log("Paramount+ ad detection initialized")}function m(){chrome.runtime?chrome.runtime.sendMessage({action:"getAdMuterState"}).then((function(e){if(!e)throw new Error("No response received from background script");(n=e.enabled)&&u()})).catch((function(e){console.error("Failed to get initial state:",e.message),l()})):console.error("Chrome runtime not available")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m(),chrome.runtime.onMessage.addListener((function(t,r,a){return"updateAdMuterState"===t.action&&((n=t.enabled)?u():(e&&(e.disconnect(),e=null),console.log("Paramount+ ad detection stopped"),o&&d()),a({success:!0})),!0})),console.log("Paramount+ content script loaded")})();