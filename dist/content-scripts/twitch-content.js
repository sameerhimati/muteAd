(()=>{var e=null,t=!1,o=!1,n=0,r=0;function a(){if(t)try{var e=['[aria-label="Ad"]','[data-a-target="video-ad-label"]','.video-player__overlay[data-a-target="player-overlay-ad-alert"]'].some((function(e){return document.querySelector(e)}));e&&!o?(o=!0,n=Date.now(),console.log("Twitch ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){if(!e||!e.success)throw console.error("Failed to mute tab:",e?e.error:"Unknown error"),new Error("Failed to mute tab");console.log("Tab muted successfully")})).catch((function(e){console.error("Error sending mute message:",e),i(e)}))):!e&&o&&(o=!1,c()),console.log("Twitch ad check:",{adDetected:e,isAdPlaying:o}),r=0}catch(e){console.error("Error checking for Twitch ads:",e),i(e)}}function c(){console.log("Ad ended, attempting to unmute tab");var e=Math.round((Date.now()-n)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully")})).catch((function(e){console.error("Error sending unmute message:",e),i(e)}))}function i(e){console.error("Handling extension error:",e),++r>=5?(console.error("Max errors reached. Disabling ad detection temporarily."),d(),setTimeout((function(){console.log("Attempting to re-enable ad detection"),r=0,s()}),6e4)):e.message.includes("Extension context invalidated")?(console.log("Extension context invalidated. Reloading ad detection."),d(),setTimeout((function(){s()}),1e3)):e.message.includes("Permission denied")&&console.log("Permission denied error. This may affect some functionality.")}function s(){e&&e.disconnect(),e=new MutationObserver((function(){a()}));var t={childList:!0,subtree:!0,attributes:!0,characterData:!0};!function o(){var n=document.querySelector(".video-player")||document.body;n?(console.log("Player container found, initializing ad detection"),e.observe(n,t)):(console.log("Player container not found, will retry"),setTimeout(o,1e3))}(),console.log("Twitch ad detection initialized"),setInterval(a,500)}function d(){e&&(e.disconnect(),e=null),console.log("Twitch ad detection stopped")}chrome.runtime.onMessage.addListener((function(e,n,r){return"updateAdMuterState"===e.action?((t=e.enabled)?s():(d(),o&&c()),r({success:!0})):"initializeAdDetection"===e.action&&chrome.storage.sync.get(["adMuterEnabled"],(function(e){(t=e.adMuterEnabled)&&s(),r({success:!0})})),!0})),chrome.storage.sync.get(["adMuterEnabled"],(function(e){(t=!0===e.adMuterEnabled)&&s()})),console.log("Twitch content script loaded")})();