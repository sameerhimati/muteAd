(()=>{var e=null,n=!0,o=!1,t=0,a=0;function c(){if(n)try{var e=[".ad-container",".ad-overlay",".ad-banner",'[data-testid="ad-overlay"]','[data-testid="ad-banner"]',".player-ad-overlay",".ad-pause-card"].some((function(e){return document.querySelector(e)}))||((c=document.querySelector("video"))&&(c.currentTime,c.duration),!1)||!1;e?++a>=3&&!o&&(o=!0,t=Date.now(),console.log("HBO Max ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){e&&e.success?console.log("Tab muted successfully"):console.log("Failed to mute tab:",e?e.error:"Unknown error")})).catch((function(e){console.log("Error sending mute message:",e),r(e)}))):(a>=3&&o&&(o=!1,console.log("HBO Max ad ended, attempting to unmute tab"),chrome.runtime.sendMessage({action:"unmuteTab"}).then((function(e){var n;e&&e.success?(console.log("Tab unmuted successfully"),n=Math.round((Date.now()-t)/1e3),chrome.runtime.sendMessage({action:"updateMetrics",muteDuration:n})):console.log("Failed to unmute tab:",e?e.error:"Unknown error")})).catch((function(e){console.log("Error sending unmute message:",e),r(e)}))),a=0),console.log("HBO Max ad check:",{adDetected:e,consecutiveAdChecks:a,isAdPlaying:o})}catch(e){console.log("Error checking for HBO Max ads:",e),r(e)}var c}function r(e){console.log("Handling extension error:",e),e.message.includes("Extension context invalidated")?(console.log("Extension context invalidated. Reloading ad detection."),d(),setTimeout((function(){s()}),1e3)):e.message.includes("Permission denied")&&console.log("Permission denied error. This may affect some functionality.")}function s(){e&&e.disconnect(),e=new MutationObserver((function(){c()}));var n={childList:!0,subtree:!0,attributes:!0,characterData:!0};function o(){var o=document.querySelector(".video-player")||document.body;e.observe(o,n),console.log("Observing HBO Max player container"),c(),console.log("HBO Max ad detection initialized")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o(),setInterval(c,1e3)}function d(){e&&(e.disconnect(),e=null),console.log("HBO Max ad detection stopped")}chrome.storage.sync.get(["adMuterEnabled"],(function(e){(n=void 0===e.adMuterEnabled||e.adMuterEnabled)&&s()})),chrome.runtime.onMessage.addListener((function(e,o,t){return"toggleAdMuter"===e.action&&(n=e.enabled,console.log("Ad Muter toggled on HBO Max:",n),n?s():d(),t({success:!0})),!0})),s(),console.log("HBO Max content script loaded")})();