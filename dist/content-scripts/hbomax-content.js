(()=>{var e=null,n=!1,o=!1,t=0,r=0,a=0;function c(){if(n)try{var e=[".ad-container",".ad-overlay",".ad-banner",'[data-testid="ad-overlay"]','[data-testid="ad-banner"]',".player-ad-overlay",".ad-pause-card"].some((function(e){return document.querySelector(e)}))||(document.querySelector("video"),!1)||!1;e?++r>=3&&!o&&(o=!0,t=Date.now(),console.log("HBO Max ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){if(!e||!e.success)throw new Error("Failed to mute tab: "+(e?e.error:"Unknown error"));console.log("Tab muted successfully")})).catch((function(e){console.error("Error sending mute message:",e),s(e)}))):(r>=3&&o&&(o=!1,i()),r=0),console.log("HBO Max ad check:",{adDetected:e,consecutiveAdChecks:r,isAdPlaying:o}),a=0}catch(e){console.error("Error checking for HBO Max ads:",e),s(e)}}function i(){console.log("HBO Max ad ended, attempting to unmute tab");var e=Math.round((Date.now()-t)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully")})).catch((function(e){console.error("Error sending unmute message:",e),s(e)}))}function s(e){console.error("Handling extension error:",e),(e.message.includes("Extension context invalidated")||e.message.includes("Chrome runtime not available"))&&d()}function d(){a>=5?console.error("Max reconnection attempts reached. Please refresh the page."):(a++,console.log("Attempting to reconnect to extension (Attempt ".concat(a,")")),setTimeout((function(){chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"ping"}).then((function(e){console.log("Reconnected to extension successfully"),l()})).catch((function(e){console.log("Reconnection failed, retrying..."),d()})):(console.log("Chrome runtime still not available, retrying..."),d())}),2e3))}function l(){e&&e.disconnect(),e=new MutationObserver((function(){c()}));var n={childList:!0,subtree:!0,attributes:!0,characterData:!0};!function o(){var t=document.querySelector(".video-player")||document.body;t?(console.log("Player container found, initializing ad detection"),e.observe(t,n),setInterval(c,500)):(console.log("Player container not found, will retry"),setTimeout(o,1e3))}(),console.log("HBO Max ad detection initialized")}function u(){chrome.runtime?chrome.runtime.sendMessage({action:"getAdMuterState"}).then((function(e){if(!e)throw new Error("No response received from background script");(n=e.enabled)&&l()})).catch((function(e){console.error("Failed to get initial state:",e.message),d()})):console.error("Chrome runtime not available")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),chrome.runtime.onMessage.addListener((function(t,r,a){return"updateAdMuterState"===t.action&&((n=t.enabled)?l():(e&&(e.disconnect(),e=null),console.log("HBO Max ad detection stopped"),o&&i()),a({success:!0})),!0})),console.log("HBO Max content script loaded")})();