(()=>{var e=null,n=!1,o=!1,t=0,r=0,c=0;function s(){e&&e.disconnect(),(e=new MutationObserver(i)).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}),console.log("Peacock ad detection initialized"),setInterval(i,500)}function i(){if(n)try{var e=document.querySelector(".countdown__foreground-ring"),s=document.querySelector(".countdown-container.ad-countdown__container");if(e&&s){o||(o=!0,t=Date.now(),console.log("Ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){if(!e||!e.success)throw new Error("Failed to mute tab: "+(e?e.error:"Unknown error"));console.log("Tab muted successfully")})).catch((function(e){console.error("Error sending mute message:",e),u(e)})));var i=s.querySelector(".countdown__remaining-time");if(i){var d=parseInt(i.textContent);isNaN(d)||(r=d,console.log("Ad duration detected: ".concat(r," seconds")))}}else o&&(o=!1,a());c=0}catch(e){console.error("Error checking for Peacock ads:",e),u(e)}}function a(){console.log("Ad ended, attempting to unmute tab");var e=Math.round((Date.now()-t)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully")})).catch((function(e){console.error("Error sending unmute message:",e),u(e)}))}function u(e){console.error("Handling extension error:",e),e.message.includes("Extension context invalidated")&&d()}function d(){c>=5?console.error("Max reconnection attempts reached. Please refresh the page."):(c++,console.log("Attempting to reconnect to extension (Attempt ".concat(c,")")),setTimeout((function(){chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"ping"}).then((function(e){console.log("Reconnected to extension successfully"),s()})).catch((function(e){console.log("Reconnection failed, retrying..."),d()})):(console.log("Chrome runtime still not available, retrying..."),d())}),RECONNECT_INTERVAL))}function l(){chrome.runtime?chrome.runtime.sendMessage({action:"getAdMuterState"}).then((function(e){if(!e)throw new Error("No response received from background script");(n=e.enabled)&&s()})).catch((function(e){console.error("Failed to get initial state:",e.message),d()})):console.error("Chrome runtime not available")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l(),chrome.runtime.onMessage.addListener((function(t,r,c){return"updateAdMuterState"===t.action&&((n=t.enabled)?s():(e&&(e.disconnect(),e=null),console.log("Ad detection stopped"),o&&a()),c({success:!0})),!0})),console.log("Peacock content script loaded")})();