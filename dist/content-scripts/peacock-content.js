(()=>{var e=null,o=!1,n=!1,t=0,r=0,c=0;function s(){e&&e.disconnect(),(e=new MutationObserver(a)).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}),console.log("Peacock ad detection initialized"),setInterval(a,500)}function a(){if(o)try{var e=document.querySelector(".countdown__foreground-ring"),s=document.querySelector(".countdown-container.ad-countdown__container");if(e&&s){n||(n=!0,t=Date.now(),console.log("Peacock ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"},(function(e){chrome.runtime.lastError?(console.error("Error sending mute message:",chrome.runtime.lastError),u(chrome.runtime.lastError)):e&&e.success?console.log("Tab muted successfully"):console.error("Failed to mute tab:",e?e.error:"Unknown error")})));var a=s.querySelector(".countdown__remaining-time");if(a){var l=parseInt(a.textContent);isNaN(l)||(r=l,console.log("Ad duration detected: ".concat(r," seconds")))}}else n&&(n=!1,i());c=0}catch(e){console.error("Error checking for Peacock ads:",e),u(e)}}function i(){console.log("Ad ended, attempting to unmute tab");var e=Math.round((Date.now()-t)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully")})).catch((function(e){console.error("Error sending unmute message:",e),u(e)}))}function u(e){console.error("Handling extension error:",e),e.message.includes("Extension context invalidated")&&l()}function l(){c>=5?console.error("Max reconnection attempts reached. Please refresh the page."):(c++,console.log("Attempting to reconnect to extension (Attempt ".concat(c,")")),setTimeout((function(){chrome.runtime.sendMessage({action:"ping"},(function(e){chrome.runtime.lastError?(console.log("Reconnection failed, retrying..."),l()):(console.log("Reconnected to extension successfully"),s())}))}),1e3*c))}chrome.runtime.sendMessage({action:"getAdMuterState"},(function(e){chrome.runtime.lastError?(console.error("Failed to get initial state:",chrome.runtime.lastError),l()):(o=e.enabled)&&s()})),chrome.runtime.onMessage.addListener((function(t,r,c){return"updateAdMuterState"===t.action&&((o=t.enabled)?s():(e&&(e.disconnect(),e=null),console.log("Ad detection stopped"),n&&i()),c({success:!0})),!0})),console.log("Peacock content script loaded")})();