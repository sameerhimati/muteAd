(()=>{var e=null,t=!1,n=!1,o=0,i=0;function c(){if(t)try{var e=document.querySelector(".ytp-ad-player-overlay, .video-ads.ytp-ad-module"),c=document.querySelector('.ytp-ad-skip-button, .videoAdUiSkipButton, [id^="skip-button"], .ytp-ad-skip-button-modern'),l=document.querySelector(".ytp-ad-text, .videoAdUiAttribution, .ytp-ad-preview-text"),s=document.querySelector(".ad-showing, .ytp-ad-overlay-container"),u=!(!e||!(c||l||s));console.log("Checking for ads:",{adOverlay:!!e,skipButton:!!c,adText:!!l,adDisplayContainer:!!s,newAdPlaying:u,currentAdPlayingState:n}),u&&!n?(n=!0,o=Date.now(),t&&(console.log("Ad detected, attempting to mute tab"),chrome.runtime.sendMessage({action:"muteTab"}).then((function(e){if(!e||!e.success)throw console.log("Failed to mute tab:",e?e.error:"Unknown error"),new Error("Failed to mute tab");console.log("Tab muted successfully")})).catch((function(e){console.log("Error sending mute message:",e),r(e)})))):!u&&n&&(n=!1,a()),n&&c&&function(e){if(e&&null!==e.offsetParent){var t=function(){if(o>=i)console.log("Max skip attempts reached. Unable to skip ad.");else{var e=n[o%n.length];try{e(),console.log("Skip attempt made")}catch(e){console.log("Error during skip attempt:",e),r(e)}setTimeout((function(){document.querySelector(".ad-showing")?(console.log("Ad still playing. Retrying skip..."),o++,t()):console.log("Ad skipped successfully")}),500)}};console.log("Skip button detected, attempting to skip");var n=[function(){return e.click()},function(){return e.dispatchEvent(new MouseEvent("click",{bubbles:!0}))},function(){var t=e.getBoundingClientRect();e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,clientX:t.left+t.width/2,clientY:t.top+t.height/2}))}],o=0,i=5;t()}}(c),i=0}catch(e){console.error("Error checking for YouTube ads:",e),r(e)}}function r(e){console.log("Handling extension error:",e),++i>=5?(console.log("Max errors reached. Disabling ad detection temporarily."),s(),setTimeout((function(){console.log("Attempting to re-enable ad detection"),i=0,l()}),6e4)):e.message.includes("Extension context invalidated")?(console.log("Extension context invalidated. Reloading ad detection."),s(),setTimeout((function(){l()}),1e3)):e.message.includes("Permission denied")&&console.log("Permission denied error. This may affect some functionality.")}function a(){console.log("Ad ended, attempting to unmute tab");var e=Math.round((Date.now()-o)/1e3);chrome.runtime.sendMessage({action:"unmuteTab",adDuration:e}).then((function(e){if(!e||!e.success)throw console.error("Failed to unmute tab:",e?e.error:"Unknown error"),new Error("Failed to unmute tab");console.log("Tab unmuted successfully")})).catch((function(e){console.error("Error sending unmute message:",e),r(e)}))}function l(){e&&e.disconnect(),e=new MutationObserver((function(){c()}));var t={childList:!0,subtree:!0};!function n(){var o=document.querySelector("#player-container")||document.body;o?(console.log("Player container found, initializing ad detection"),e.observe(o,t)):(console.log("Player container not found, will retry"),setTimeout(n,1e3))}(),console.log("YouTube ad detection initialized"),setInterval(c,1e3)}function s(){e&&(e.disconnect(),e=null),console.log("YouTube ad detection stopped")}chrome.runtime.onMessage.addListener((function(e,o,i){return"updateAdMuterState"===e.action?((t=e.enabled)?l():(s(),n&&a()),i({success:!0})):"initializeAdDetection"===e.action&&chrome.storage.sync.get(["adMuterEnabled"],(function(e){(t=e.adMuterEnabled)&&l(),i({success:!0})})),!0})),chrome.storage.sync.get(["adMuterEnabled"],(function(e){(t=!0===e.adMuterEnabled)&&l()})),console.log("YouTube content script loaded")})();